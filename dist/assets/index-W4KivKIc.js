(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();const l=document.getElementById("roomId"),g=document.getElementById("joinBtn"),m=document.getElementById("startBtn"),u=document.getElementById("voiceSelect"),f=document.getElementById("instrumentSelect"),p=document.getElementById("videoToggle"),y=document.getElementById("localVideo");document.getElementById("localVoice");document.getElementById("localInstrument");const E=document.getElementById("remoteVideo"),v=document.getElementById("remoteAudios");let d,i,a;async function I(){const c=await navigator.mediaDevices.enumerateDevices();u.innerHTML="",f.innerHTML="",c.filter(n=>n.kind==="audioinput").forEach((n,r)=>{const e=document.createElement("option");e.value=n.deviceId,e.text=n.label||`Microphone ${r+1}`,u.appendChild(e.cloneNode(!0)),f.appendChild(e.cloneNode(!0))})}l.addEventListener("input",()=>{m.disabled=!l.value.trim()});g.addEventListener("click",()=>{const c=l.value.trim();if(!c)return alert("Enter a Room ID!");m.disabled=!1,a=new WebSocket(`wss://jam-server-6ew4.onrender.com?room=${c}`),a.onopen=()=>console.log("Connected to backend WebSocket!"),a.onmessage=async n=>{const r=JSON.parse(n.data);if(r.type==="offer"){await i.setRemoteDescription(new RTCSessionDescription(r.offer));const e=await i.createAnswer();await i.setLocalDescription(e),a.send(JSON.stringify({type:"answer",answer:e}))}if(r.type==="ice-candidate")try{await i.addIceCandidate(r.candidate)}catch(e){console.error("Error adding ICE candidate:",e)}}});m.addEventListener("click",async()=>{try{const c=u.value,n={video:p.checked,audio:{deviceId:c?{exact:c}:void 0}};d=await navigator.mediaDevices.getUserMedia(n),p.checked&&(y.srcObject=d),i=new RTCPeerConnection,d.getTracks().forEach(e=>i.addTrack(e,d)),i.ontrack=e=>{e.streams[0].getTracks().forEach(t=>{if(t.kind==="video"&&(E.srcObject=e.streams[0]),t.kind==="audio"){const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([t]),v.appendChild(o)}})},i.onicecandidate=e=>{e.candidate&&a.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))};const r=await i.createOffer();await i.setLocalDescription(r),a.send(JSON.stringify({type:"offer",offer:r})),alert("Jam started! Your media is live.")}catch(c){console.error("Failed to start jam:",c),alert("Error starting jam. Check console for details.")}});I();
